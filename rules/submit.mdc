---
description: Complex task analysis and implementation with detailed reasoning and multiple solution exploration
globs:
alwaysApply: false
---

## Анализ задания

Оцени свою уверенность в понимании заданного задания от 0 до 100%. Если твоя уверенность по какому то из существенных
пунктов задачи не больше 70% то Прежде чем выполнять задачу, задай мне уточняющие вопросы.

## Работа с документацией (папки `docs`)

Под фразой «требуется изучение документации» подразумевается ситуация, когда без чтения docs нельзя достаточно надёжно
понять, каким должно быть корректное поведение/контракт.

Считай, что **изучение документации ТРЕБУЕТСЯ**, и автоматически переходи к работе с docs, если выполняется хоть одно из
условий:

- задача явно затрагивает спецификацию, поведение фичи, публичные API или контракты между слоями/модулями;
- причина бага или корректное поведение **не полностью очевидны** из одного редактируемого файла, и нужно понять «как
  должно быть»;
- изменение затрагивает код, который используется в нескольких модулях/слоях, или может повлиять на другие части
  системы;
- я прямо прошу свериться с документацией, спецификацией или контрактами (упоминания вида: `docs`, «спека», «контракт»,
  «описано в документации» и т.п.).
- выполняются изменения структуры/архитектуры/публичных интерфейсов (переносы/переименования файлов/папок, изменение
  точек входа/entry points и реэкспортов, пути импортов, публичные имена/ключи slice/reducer/context/hook/prop,
  API endpoints/URLs/CLI, конфиги/env, дерево директорий) — необходимо актуализировать все соответствующие упоминания
  в `docs` (пути, схемы директорий, import specifiers, примеры кода и команд).

Считай, что **изучение документации НЕ требуется**, и **НЕ лезь в `docs`**, если:

- я явно написал, что документацию смотреть не нужно (например: «docs не смотреть», «документацию не трогать»);
- задача явно про **локальные/атомарные правки внутри одного файла**, которые:
    - не меняют внешнее поведение и контракты,
    - не меняют бизнес-логику,
    - не затрагивают публичные API,
      например:
    - форматирование, правки стиля, мелкие линтер-фиксы;
    - переименование локальной переменной/функции, не торчащей наружу;
    - явное исправление опечатки;
    - тривиальный фикс типов/импортов без изменения логики;
    - рефакторинг в пределах файла, при котором сохраняется поведение и контракты (перенос кода, выделение внутренней
      функции и т.п.).

### Изучение документации при необходимости.

Если по критериям выше **изучение документации требуется**, то при изучении документации следуй следующей логике:

- В проекте могут существовать несколько уровней папок `docs`. Каждая папка docs документирует код своей родительской
  директории и всего её содержимого на всех уровнях вложенности.
- При работе с файлом изучай все docs-папки, расположенные на пути от директории файла до корня проекта. Документация из
  более глубоких уровней имеет приоритет над документацией из верхних уровней.

### Правки документации при необходимости.

Если по критериям выше **изучение документации требуется**, то выполняй следующую логику.

- Если, изучая код и соответствующие docs, ты обнаруживаешь несоответствия между кодом и документацией, обновляй
  соответствующие `docs`-файлы так, чтобы документация отражала текущее корректное состояние кода.
- Если ты вносишь в код изменения, которые требуют отражения в изученных `docs`-папках, обновляй соответствующие файлы
  документации:
    - сохраняй существующую структуру, формат и стиль документации;
    - добавляй информацию в соответствующие секции; если подходящей секции нет — создай новую в этой же docs-папке;
    - при необходимости обновляй и документацию более высоких уровней, если изменение затрагивает описанное там общее
      поведение или контракт.
- При обновлении документации:
    - используй только английский язык;
    - не добавляй лишних или малозначительных пояснений;
    - не изменяй части, не связанные с вносимыми изменениями.

### Checklist по работе с документацией.

Если по критериям выше **изучение документации требуется**, то перед ЛЮБЫМИ правками кода **в рамках такой задачи**
выполни Docs-first чек-лист:

- [ ] Найди все `docs` на пути от редактируемого файла до корня проекта и перечисли их в статус-обновлении.
- [ ] Прочитай профильные файлы (например, спецификации поведения) и выпиши 3–7 ключевых инвариантов.
- [ ] Сверь свои планируемые правки с этими инвариантами; если есть расхождения — сначала обнови docs или скорректируй
  план.
- [ ] В финальном ответе явно укажи: требовалось ли по этим правилам изучение документации, какие `docs` прочитаны, и
  изменения в `docs` требуются/не требуются (и почему).
- [ ] Если были изменения, влияющие на документацию (пути/импорты, entry points/экспорты, структура каталогов, публичные
  идентификаторы, API/CLI/URLs, конфиги/env) — пройтись по `docs` и обновить все упоминания (файлопути, import
  specifiers, публичные имена, примеры кода и команд), чтобы они соответствовали текущему состоянию кода.

## Число вариантов для рассмотрения

`заданное_число_вариантов_для_рассмотрения` - это указанное мною выше число вариантов реализации или версий причин
бага, которые нужно рассмотреть. А если я не указал выше данного числа, то это число ≥20.

## Необходимые ответы на вопросы

Если в моем описании задачи есть блок с названием, содержащим слово "Вопрос" или "Вопросы" (типа "Критически важные
вопросы при поиске решения" или "Вопросы для анализа" и т.п.), и если этот блок состоит из вопросов, на которые должны
быть даны ответы при поиске причин бага, то этот набор вопросов мы далее будем именовать как `заданные_вопросы`.

## Заданные ограничения

Если в моем описании задачи есть блок с названием, содержащим слово "Ограничения" (типа "Заданные ограничения" и т.п.),
то этот набор ограничений мы далее будем именовать как `заданные_ограничения`.

## Если задача заключается в фиксе бага

Если проблема ясна, то пофикси её, при этом рассмотрев как минимум `заданное_число_вариантов_для_рассмотрения`
вариантов реализации.
А если проблема не ясна, то не вноси правок в логику, а лишь пропиши ещё консольные логи, рассмотрев еще как минимум
`заданное_число_вариантов_для_рассмотрения` версий.

ВАЖНО!!! К рассмотрению принимай только те версии причин бага, в которых ты можешь дать хоть какие-то логические ответы
на `заданные_вопросы`.
Если ты не обнаружил что не можешь придумать заданное число версий, то ок, можешь рассмотреть меньше.

## Если задача заключается в создании новой функциональности

Если еще нет одобренного решения или плана реализации, и задача касается создания новой функциональности, то перед
реализацией опиши какие варианты решения данной задачи ты видишь. Желательно рассмотреть КАК МИНИМУМ 
`заданное_число_вариантов_для_рассмотрения`, из которых ты будешь делать выбор наиболее корректного, краткого,
элегантного и идеоматичного данному проекту с учетом испольуемых в нем технологий, подходов и библиотек (и их версий).
ВАЖНО!!! К рассмотрению принимай только те варианты реализации, которые учитывают `заданные_ограничения`.
Если лучшим окажется последнее решение, то предложи еще 10 решений, и в итоге выбери лучшее из всех рассмотренных.
Если в итоге ты выбрал последний или предпоследний вариант из рассматриваемых, то добавь еще к рассмотрению 10
вариантов. Примеры:

- Если ты рассматривал 20 вариантов и лучшим оказался, на твой взгляд, 19-й вариант, то добавь к рассмотрению еще 10
  вариантов.
- Если ты рассматривал 20 вариантов и лучшим оказался, на твой взгляд, 20-й вариант, то добавь к рассмотрению еще 10
  вариантов.

Если задача касается просто анализа, а не фикса бага или создания новой функциональности, то игнорируй этот раздел.

## Проектирование или написание кода

- При размшлении над каждым из вариантов, начни рассуждение с большой неуверенностью, и по мере размышлений постепенно
  набирай уверенность, анализируя плюсы и минусы конкретного варианта. Не делай поспешных выводов. Делай описание этих
  вариантов кратким.
- Если это баг, и его причины для тебя не ясны, то добавь в коде консоль логов, которые позволят тебе наиболее точно
  вычислить причину. Которые возможно вычленят из всех возможных вариантов лишь 1 правильный, или хотя бы позволят
  максимально сузить число возможных и вариантов. При написании логов помни что объекты из консоли копируются в
  сокращенном виде, типа {...}. Так что либо для вывода данных в виде объектов используй какой-нибудь JSON-сериализатор,
  либо выводи данные в виде строк.
- Follow the user’s requirements carefully & to the letter.
- Fully implement all requested functionality.
- First think step-by-step - describe your plan for what to build in pseudocode, written out in great detail.
- Value good arguments over authorities, the source is irrelevant
- You may use high levels of speculation or prediction, just flag it for me
- Focus on easy and readability code, over being performant. Write maintainable and scalable code
- Если добавляешь функциональность, аналогичную уже существующей (например, редьюсер или компонент), следуй стилю и
  структуре текущего кода.
- Старайся следовать наилучшим практикам Clean Code.
- При проектировании старайся следовать принципам SOLID, DRY, а так же "High Cohesion & Low Coupling".
- При редактировании ecmascript-файлов соблюдай правила, прописанные в файле .cursor/rules/ecmascript-code-style.mdc
- Be concise Minimize any other prose.
- Ensure code is complete! Verify thoroughly finalised.
- If you do not know the answer, say so, instead of guessing. Я тогда постараюсь предоставить тебе больше нужного
  контекста. Не надо делать что-то наугад.
- Implement proper error handling

### Комментарии к коду

- При изменении логики обязательно синхронизируй комментарии (при их наличии): обновляй формулировки или удаляй
  устаревшие/вводящие в заблуждение.
- Поддерживай комментарии краткими и по делу; не оставляй «мертвые»/несоответствующие текущему коду пояснения.

Отвечай мне только по-русски!

use context7


