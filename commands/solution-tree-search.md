Задача: Выполни структурированный древовидный поиск наилучшего решения для текущей задачи.

## Учет ограничений и критериев

Если в описании задачи есть блок с названием, содержащим слово "Ограничения" (например, "Заданные ограничения"),
воспринимай его содержимое как `заданные_ограничения`. **Все** рассматриваемые варианты решения обязаны
соответствовать этим ограничениям; нарушающие `заданные_ограничения` варианты сразу отбрасывай.

Если в задаче явно описаны критерии выбора решения, используй их как `критерий_поиска`.  
Если явных критериев нет, используй дефолтный `критерий_поиска`:

- корректность;
- краткость;
- элегантность;
- идиоматичность проекту (учитывая технологии, подходы, библиотеки и их версии).

---

## 1) Список абстрактных вариантов

Сгенерируй "список абстрактных вариантов": как минимум `{max_abstract_variants}` идей, отражающих общие принципы
возможных решений.

- Описывай каждый вариант очень кратко (1–2 предложения).
- На этом этапе **не** углубляйся в детали реализации.
- Варианты, очевидно противоречащие `заданные_ограничения`, не включай.

---

## 2) Список перспективных вариантов

Из "списка абстрактных вариантов" выбери `{num_promising}` наиболее перспективных по `критерий_поиска`.  
Этот поднабор далее называем "список перспективных вариантов".

---

## 3) Деревовидный поиск решений

На основе "списка перспективных вариантов" выполни древовидный поиск решений.

### Ограничения дерева

- Максимальная глубина дерева (уровней): не более `{max_depth}`.
- Максимальное количество ветвлений на каждом уровне: не более `{max_branching}`.
    - Принципы ветвления:
      - оцени ключевые направления развития текущего варианта и создай на их основе несколько ветвей
        (но не больше `{max_branching}`);
      - ветвления делай осмысленно, опираясь на `критерий_поиска`
        (например, разные компромиссы между простотой, расширяемостью, переиспользованием существующих абстракций).
- Аккумулятор успешных решений: не более `{max_succeed}` листовых вариантов.

Под **успешным решением** понимается лист дерева, который:
- не нарушает `заданные_ограничения`;
- достаточно хорошо удовлетворяет `критерий_поиска` относительно альтернатив.

### Правила обхода дерева

- Каждый узел дерева — это конкретизация одного из элементов "списка перспективных вариантов" (или его потомка):
  уточнение архитектуры, изменение границ ответственности, переразбиение модулей, выбор других компромиссов и т.д.
- Ветка может быть **тупиковой**:
    - если по мере развития варианта выясняется, что он нарушает `заданные_ограничения`,
      ведет к явному овер-инжинирингу/некорректности или заметно хуже удовлетворяет `критерий_поиска`, чем альтернативы,
      то эта ветка порождает **0 потомков**;
    - финальный лист тупиковой ветки **не добавляется** в аккумулятор успешных решений.

---

## 4) Выбор наилучшего решения и реализация

1. Из аккумулятора успешных решений выбери одно наилучшее по `критерий_поиска`
   (строго соблюдая `заданные_ограничения`).
2. Если в формулировке задачи **не сказано**, что реализация не нужна:
    - детально опиши структуру выбранного решения (основные шаги, архитектуру, ключевые абстракции);
    - затем реализуй его в коде (следуя общим правилам проекта и другим активным правилам Cursor).
3. Если в задаче явно указано, что реализация не требуется, ограничься подробным описанием выбранного решения и
   предполагаемой структуры кода.

---

## Интерпретация входа (параметры и ограничения)

После имени команды могут идти **аргументы в свободной форме**: числа, текст, дополнительные пожелания и ограничения —
в произвольном порядке. По контексту постарайся привязать числа к параметрам.

Если какое-либо число не указано явно, используй дефолтное значение.

- `{max_abstract_variants}` — минимальное количество абстрактных вариантов.
    - По умолчанию: **20**.

- `{num_promising}` — размер "списка перспективных вариантов".
    - По умолчанию: **5**.

- `{max_depth}` — максимальная глубина дерева.
    - По умолчанию: **5**.

- `{max_branching}` — максимальное число ветвлений на уровне.
    - По умолчанию: **3**.

- `{max_succeed}` — максимальное количество успешных листьев в аккумуляторе.
    - По умолчанию: **40**.

- `критерий_поиска`:
    - если критерии явно описаны в задаче или аргументах команды
      (например, блок после "критерий поиска:" / "оценивать по:"), используй их как `критерий_поиска`;
    - если нет — используй дефолтное определение из раздела "Учет ограничений и критериев".
