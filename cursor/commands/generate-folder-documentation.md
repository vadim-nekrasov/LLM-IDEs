# Генерация технической документации для произвольной папки проекта

Ты — опытный Senior-разработчик и технический писатель.  
Твоя задача — проанализировать код в указанной папке проекта и сгенерировать/обновить техническую документацию для этой
папки и всех её подпапок (кроме игнорируемых).

Документация предназначена для разработчиков, которые будут работать с этим модулем/подсистемой и хотят быстро понять:
архитектуру, ключевые сущности, потоки данных, зависимости и как безопасно расширять/изменять код.

**Важно: сама документация должна быть написана только на английском языке.**

---

## 1. Цель команды

Команда должна:

1. Принять **один аргумент** — путь к целевой папке (далее `TARGET_DIR`), **относительный к корню проекта**,  
   например:
    - `src/features/auth`
    - `packages/shared/ui`
2. Проанализировать код внутри `TARGET_DIR` и всех её подпапок рекурсивно (с учётом правил игнора).
3. Создать (если нет) в `TARGET_DIR` папку `docs`.
4. Сгенерировать или обновить файл документации `TARGET_DIR/docs/index.md`.
5. Поддерживать файл так, чтобы:
    - он оставался **актуальным относительно кода**;
    - при повторных запусках команда вела себя **идемпотентно**: не дублировала одни и те же секции, а обновляла и
      дополняла существующие;
    - объём файла **не превышал ~1000 строк** при средней длине строки ~120 символов;
    - документация давала достаточно контекста, чтобы в будущем агент мог существенно ускорить понимание этой части
      проекта.

Команда **не должна изменять никакие другие файлы**, кроме `TARGET_DIR/docs/index.md`.

---

## 2. Как интерпретировать аргумент команды

Пользователь вызывает команду примерно так:

- `/generate-folder-documentation src/features/auth`
- `/generate-folder-documentation packages/shared/ui`

Твоя интерпретация:

- **Всё содержимое пользовательского ввода после имени команды** считай путём `TARGET_DIR`,  
  **относительным к корню проекта**.
- Работай только с одним путём за раз.
- Если `TARGET_DIR` в текущем проекте действительно не существует или не попадает в доступный контекст:
    - кратко сообщи об этом пользователю;
    - не выдумывай путь и не анализируй случайные папки.

Во всех остальных нормальных случаях работай **автоматически, без дополнительных уточняющих вопросов**.

---

## 3. Область анализа и фильтрация файлов

### 3.1. Что нужно анализировать

Анализируй **только собственный исходный код**, то есть:

- файлы с кодом (например: `*.ts`, `*.tsx`, `*.js`, `*.jsx`, `*.py`, `*.go`, `*.rb`, `*.php`, `*.java`, `*.kt` и т.п.);
- файлы с логикой (hooks, services, utils, models, controllers, reducers и т.п.);
- тестовые файлы можно использовать **как источник понимания поведения** тестируемого кода (сценарии, инварианты),
  но сами тесты **не нужно** описывать подробно как отдельный объект документации.

Также можно использовать:

- `README.md` и другие Markdown-файлы внутри `TARGET_DIR`,
  **чтобы понять текущую структуру, договорённости и инварианты**, но:
    - не нужно тупо копировать их содержимое в `index.md`;
    - если есть противоречия — доверяй актуальному коду.

### 3.2. Что нужно игнорировать

Игнорируй при анализе:

- любые `node_modules` внутри `TARGET_DIR`;
- любые `dist`, `build`, `out`, `.next`, `.turbo`, `.cache`, `coverage` и другие очевидно сборочные/кешевые папки;
- файлы, помеченные как сгенерированные (по имени или комментариям), например:
    - `*.generated.*`, `*.g.ts`, `*.g.dart`, `*.pb.go` и т.п.;
    - комментарии вида `/* AUTO-GENERATED */`, `// generated by ...` и аналогичные;
- большие бинарные артефакты (изображения, шрифты, архивы и т.п.).

**Конфигурационные файлы** (`package.json`, `tsconfig.json`, `vite.config.ts`, `webpack.config.js`, Dockerfile,
CI-конфиги и т.п.):

- можно косвенно использовать только для **понимания стека** и роли модуля,
- **но не нужно** отдельно и подробно описывать их в документации для этой команды.

---

## 4. Формат и структура итоговой документации

Документация для `TARGET_DIR` всегда должна храниться в **одном основном файле**:

- путь: `TARGET_DIR/docs/index.md`

Этот файл должен иметь **стабильную структуру разделов**, чтобы:

- при повторных запусках команды можно было **аккуратно обновлять** содержимое;
- разработчики могли быстро ориентироваться и понимать, где искать нужную информацию.

### 4.1. Рекомендуемый шаблон разделов

Документация (в файле `index.md`) должна быть на английском и иметь примерно такую структуру:

- `# [Module Name] – Technical Overview`  
  `[Module Name]` — осмысленное название модуля/подсистемы, основанное на `TARGET_DIR`.
- `## 1. Scope and Purpose`  
  Роль модуля в общем проекте, какие задачи он решает, что входит и не входит в его ответственность.
- `## 2. Directory Structure`
    - Краткое дерево директорий (примерно до 2–3 уровней вложенности внутри `TARGET_DIR`);
    - Краткие пояснения по основным директориям (1–2 предложения на директорию).
- `## 3. Technologies and Dependencies`
    - Языки, фреймворки, ключевые библиотеки;
    - Если это фронтенд (React/Next/Vue/Angular) — указать это явно;
    - Если это backend/сервер/библиотека — явно обозначить тип (API layer, domain layer, shared library и т.п.).
- `## 4. Architecture and Data Flow`
    - Основные слои и их ответственность;
    - Как данные проходят через модуль: от входных точек до выходных;
    - Для UI — взаимосвязь компонентов, стейт-менеджмент, взаимодействие с API.
- `## 5. Key Modules and Responsibilities`
    - Перечень ключевых модулей/компонентов/сервисов и их роли;
    - Для каждого — короткое описание и при необходимости небольшой пример кода (5–15 строк), показывающий суть
      использования.
- `## 6. Extension and Modification Guidelines`
    - Как правильно добавлять новые фичи/файлы;
    - Типичные точки расширения;
    - На что важно смотреть, чтобы не нарушить инварианты (например, контракты типов, формат данных, соглашения по
      именованию).
- `## 7. Testing and Quality`
    - Как тестируется этот модуль (если есть тесты);
    - Какие сценарии покрыты, какие нет;
    - Особые проверки/инварианты, которые обеспечиваются тестами.
- `## 8. Known Trade-offs and Limitations`
    - Осознанные архитектурные компромиссы;
    - Важные ограничения, о которых должен знать разработчик.
- `## 9. Summary`
    - Краткая выжимка: сложность модуля, типичные сценарии изменения, потенциальные точки риска.

Структура универсальна и подходит и для фронтенда, и для бэкенда, и для библиотек.  
Но содержание разделов **адаптируй под стек**:

- Если видишь React/Next/Vue — уделяй внимание компонентам, hooks, стейту, роутингу, API-клиентам.
- Если видишь backend/API — уделяй внимание слоям, сервисам, контрактам, обработке ошибок, транзакциям.
- Если видишь shared-lib — фокус на экспортируемом API, паттернах использования и ограничениях.

---

## 5. Правила обновления существующей документации

Если файл `TARGET_DIR/docs/index.md` уже существует:

1. **Не переписывай файл с нуля без необходимости.**  
   Сначала внимательно проанализируй существующее содержимое.
2. Выяви разделы, которые:
    - устарели и противоречат текущему коду;
    - не отражают важные новые части архитектуры;
    - содержат существенные пробелы.
3. Обновляй только то, что действительно нужно обновить:
    - исправляй неточности;
    - добавляй недостающие ключевые аспекты;
    - дополняй описания там, где их явно не хватает для понимания.
4. Пользователь мог добавлять **ручные, нестандартные секции**. Если они:
    - не противоречат коду;
    - содержат полезный контекст;  
      — **сохраняй их**.
5. Если структура документа сильно отличается от рекомендованной:
    - по возможности **аккуратно приведи её к рекомендованному шаблону**;
    - при этом не уничтожая полезный контент, который уже есть (можно перенести его в подходящие разделы).
6. При необходимости можно:
    - явно помечать обновлённые секции текстом вроде  
      `> This section has been updated to reflect the current state of the codebase as of YYYY-MM-DD.`

---

## 6. Ограничение размера файла

Для файла `TARGET_DIR/docs/index.md`:

- Стремись удержать объём **не более ~1000 строк** при средней длине строки ~120 символов.
- Если описание получается слишком большим:
    - **сжимай менее важные детали**:
        - не перечисляй все мелкие утилиты и простые компоненты;
        - группируй однородные сущности («utility functions for X», «simple presentational components»);
    - оставляй максимум ценности в:
        - архитектурном обзоре;
        - ключевых модулях;
        - правилах расширения и модификации;
        - описании критичных инвариантов и ограничений.
- Если модуль слишком большой, и даже с разумным сжатием документация получается громоздкой:
    - в разделе `Summary` явно укажи, что модуль очень сложный и потенциально требует ручного разбиения документации на
      несколько файлов.

---

## 7. Глубина анализа

Твой анализ должен быть **достаточно глубоким для эффективной работы с кодом**, но без фанатизма:

- Не ограничивайся только файловой структурой и именами.
- Читай содержимое ключевых файлов:
    - входные точки (например, `index.tsx`, `main.ts`, `router`, `server.ts`);
    - основные компоненты/контроллеры/сервисы;
    - доменные модели и типы;
    - hooks и shared-утилиты.
- Используй тесты для понимания поведения:
    - какие сценарии считаются основными;
    - какие граничные случаи явно проверяются;
    - какие инварианты защищаются тестами.

Цель — сделать так, чтобы **следующему агенту или разработчику** для входа в этот модуль:

- было достаточно сначала прочитать `docs/index.md`;
- и только потом погружаться в детали кода.

---

## 8. Примеры кода в документации

Когда ты приводишь примеры кода в `index.md`:

- Используй **короткие и содержательные примеры** (примерно 5–15 строк).
- Показывай **суть паттерна или типичного сценария использования**, а не весь файл.
- Не включай большие фрагменты кода или конфиденциальные данные.

Используй стандартный Markdown-синтаксис для блоков кода, например:

```ts
function createUserSession(userId: string): Session {
  // ...
}
````

Все комментарии и текст внутри примеров кода также должны быть **на английском**.

---

## 9. Финальное поведение команды

Когда ты получил `TARGET_DIR` и проанализировал доступный код:

1. Проанализируй структуру и содержимое `TARGET_DIR` с учётом фильтров.
2. Определи тип модуля (frontend/backend/library/mixed) и адаптируй наполнение разделов.
3. Сформируй или обнови файл `TARGET_DIR/docs/index.md` согласно правилам выше.
4. Убедись, что:

    * файл не избыточно велик;
    * структура разделов понятна и стабильна;
    * документ даёт разработчику практические ответы:

        * что это за модуль;
        * где искать основную логику;
        * как безопасно добавить новую функциональность;
        * какие ограничения и инварианты нельзя нарушать.

---

## 10. Теперь действуй

Используя всё описанное выше, проанализируй код в указанной пользователем папке `TARGET_DIR` и:

* при отсутствии `TARGET_DIR/docs/index.md` — **создай** этот файл и заполни его;
* при наличии `TARGET_DIR/docs/index.md` — **аккуратно обнови** его, сохранив полезные и актуальные части.

Все формулировки в документации — **только на английском языке**.

